<!DOCTYPE html>
<html>
<head>
	<title>TESTING TERRAIN GEN</title>
</head>
<script type="text/javascript" src="scripts/mersenne-twister.js"></script>
<script type="text/javascript" src="scripts/perlinnoise.js"></script>

<body bgcolor="lightskyblue">
<canvas id="canvas" width="480" height="640"></canvas>

<script type="text/javascript">
	this.W = 480;
	this.H = 640;

	this.c = document.getElementById("canvas");
	this.ctx = c.getContext("2d");

	ImageData.prototype.setPixel = function(x,y,r,g,b,a){
		if (typeof a == 'undefined') { a = 255};
		if (typeof g == 'undefined') { g = b = r};

		if(x>this.width || y>this.height) return false;

		var w =  this.width;
		var start = (w*(y|0)+(x|0)%w)*4;
		this.data[start] = r;
		this.data[start+1] = g;
		this.data[start+2] = b;
		this.data[start+3] = a;

		return true;
	}

	ImageData.prototype.getPixel = function(x,y){
		if(x>this.width || y>this.height) return false;

		var w =  this.width;
		var start = (w*(y|0)+(x|0)%w)*4;
		r= this.data[start] ;
		g = this.data[start+1];
		b = this.data[start+2];
		a = this.data[start+3];

		return [r,g,b,a];
	}

	ctx.clear = function(){
		ctx.save();
			ctx.fillStyle="white";
			ctx.fillRect(0,0,window.W,window.H);
		ctx.restore();
	}

	ctx.clear();

	ctx.input = function(array /*[[x,y,r,g,b,a],...]*/){
	
		var iData = this.getImageData(0,0,window.W,window.H);

		for(var x = 0; x<array.length; x++){
			if (!iData.setPixel.apply(iData,array[x])) console.log("FAKK");
		}

		this.putImageData(iData,0,0);
	}

</script>

<script type="text/javascript">

var TERRAINGEN =
{
	CreateCanvas: function( inWidth, inHeight, appendCanvas) 
	{
		var canvas = document.createElement( "canvas" );
		canvas.width = inWidth;
		canvas.height = inHeight;
		if (window.debug == true || appendCanvas==true){
      		document.body.appendChild(canvas);
    	}
		return canvas;
	},
	
	Generate: function ( inParameters )
	{
		inParameters = inParameters || {};

		// Manage default parameters
		inParameters.type = inParameters.type || 0;
		inParameters.depth = inParameters.depth || 10;
		inParameters.width = inParameters.width || 100;
		inParameters.height = inParameters.height || 100;
		inParameters.postgen = inParameters.postgen || [];
		inParameters.effect = inParameters.effect || [];
		inParameters.filter = inParameters.filter || [];
		
		if( typeof inParameters.canvas == 'undefined' )
			inParameters.canvas = this.CreateCanvas( inParameters.width, inParameters.height );
		
		var noise = inParameters.generator.Generate(inParameters);
		
		// Apply filters
		for( var i = 0; i < inParameters.filter.length; ++i )
		{
			//inParameters.filter[i].Apply( noise, inParameters );
		}


		/*
		// Create the corresponding geometry
		var geometry = this.CreateGeometry( noise, inParameters.depth, inParameters.width, inParameters.height, inParameters.widthSegments, inParameters.heightSegments );
		
		// Apply vertices effect
		for( var i = 0; i < inParameters.effect.length; ++i )
		{
			inParameters.effect[i].Apply( geometry, inParameters );
		}
		
		// Apply post algorithm as color generation
		for( var i = 0; i < inParameters.postgen.length; ++i )
		{
			inParameters.postgen[i].Apply( geometry, inParameters );
		}
		*/
		//return geometry;
	}
};

</script>

</body>
</html>